# Changelog

```
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⢿⣿⣷⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⡿⣿⣭⢿⡧⢽⣿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣵⡟⠉⣼⡇⣾⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣶⡿⡳⠛⠁⠀⠙⢺⣯⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣤⣤⣤⣤⣤⣠⣄⣠⣴⠟⠋⠀⠀⠀⢤⡾⠀⢘⢻⣧⣤⣠⣤⣴⣦⣶⣴⣤⣤⣤⣤⣄⣄⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣰⡿⠿⣟⠙⠩⢍⡉⠉⠉⠉⠉⣹⠇⠀⠀⣴⡇⣠⣾⠇⠀⠈⠿⠟⠈⢦⣄⣀⣈⣉⣉⡉⢩⣬⣽⠿⠿⢷⣄⠀⠀⠀⠀
⠀⠀⠀⠀⣴⡿⠃⠀⠉⠋⠛⠛⠉⠀⠀⠀⠀⠛⢣⣤⡿⠋⠀⠘⠏⠐⠀⢀⠀⠀⠀⠀⠉⠛⠛⣛⣛⣿⣿⠋⠀⠀⠀⠀⠹⣧⡀⠀⠀
⠀⠀⠀⣼⡏⠀⠀⠀⠀⠀⠀⠀⠀⢦⣤⣤⣠⣴⡾⠁⢀⠀⠀⠀⠀⠀⠀⠈⠻⣶⣤⠀⠀⠀⠈⠉⣹⡟⠁⠀⠀⢀⠀⠀⠀⢺⣧⠀⠀
⠀⠀⢀⣾⠇⠀⠹⠻⡟⠃⠀⠀⠀⠀⣉⣩⣉⡉⡀⢀⠀⠀⡀⠀⢀⣀⣀⠀⠀⠀⠀⣀⢀⡀⡀⢀⣿⠁⠀⢦⡿⠛⠻⣷⡀⠀⣿⡄⠀
⠀⠀⣸⣿⣤⣤⣤⣴⣦⡄⠀⠀⠀⠘⠷⢷⠲⠛⠛⠛⠻⠛⡟⠻⠻⠛⠋⠀⠀⠀⠀⠻⠛⠟⢟⣻⡿⠀⢠⡿⠃⣠⠀⠸⣧⠈⣿⡀⠀
⠀⢐⢻⡏⠉⠉⠉⠉⠉⠁⠀⠀⠀⠀⠀⠈⠀⠀⣤⣄⡀⠀⡁⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⢀⠾⣿⡇⠐⣼⠇⣰⡿⣶⠠⣿⠀⣿⡅⠀
⠀⠀⣾⡇⠀⠈⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠛⠻⠿⠿⠆⠀⠰⠟⠛⠛⠻⢛⠿⠋⢀⣿⡇⠠⣿⡄⢿⣄⣿⠀⣿⠐⣿⡆⠀
⠀⠀⣻⡷⠶⠷⢶⢦⠀⠀⠀⠈⠿⠿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠻⣶⣶⣾⣿⣇⡘⢿⡅⠘⠿⠟⢸⡟⠀⣿⡇⠀
⠀⠀⢹⣷⡄⡀⠒⠀⡀⡀⠀⠀⣀⣀⣀⣀⠀⠀⠀⠠⣄⣠⣠⡄⠀⠀⠀⠀⢶⣦⣴⣤⢶⣦⣶⣿⣿⡀⠸⣷⡀⠀⠀⣿⠃⡀⣿⡇⠀
⠀⠀⠘⠹⣿⣅⠀⠀⠙⠛⠛⠛⠛⠛⠛⠋⠀⠀⠀⠀⠈⢭⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣷⠀⠈⣷⣀⣾⠋⠰⣰⡟⠄⠀
⠀⠀⠀⠀⠻⣷⣤⣀⡀⠀⠀⠀⠀⠀⠀⠠⣀⠀⠀⠀⠀⠈⠿⠷⠶⠶⠷⠷⢤⣤⣴⣤⣤⣤⣤⠌⠛⣿⡀⠀⠈⠉⠀⢀⣼⠏⠀⠀⠀
⠀⠀⠀⠀⠀⠈⢿⣭⣉⠛⠛⠛⠛⠁⢀⠀⠛⡿⠿⢷⢷⡷⣀⠀⢀⠀⠀⡀⠀⠀⠀⡙⣿⣿⢿⣿⣿⣿⣿⣄⣀⣠⣴⡿⠁⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠉⠛⠛⠛⠛⠛⠛⠛⠛⠛⠳⠒⠶⠒⠷⠚⠶⠚⠖⠳⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠛⠉⠁⠀⠀⠀⠀⠀⠀
```

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## Versioning

Each component (Radar, PDF Generator, Deploy Tool, Web Frontend) maintains independent semantic versions:

- **MAJOR**: Breaking changes (removed CLI flags, breaking API changes, incompatible migrations)
- **MINOR**: New features, backward-compatible (new flags, new endpoints, additive migrations)
- **PATCH**: Bug fixes, backward-compatible

**Version Locations:**

- Radar: `Makefile` → `VERSION := X.Y.Z` (injected via ldflags at build time)
- PDF Generator: `tools/pdf-generator/pyproject.toml` → `version = "X.Y.Z"`
- Deploy Tool: `cmd/deploy/main.go` → `const version = "X.Y.Z"`
- Web Frontend: `web/package.json` → `"version": "X.Y.Z"`

See [Semantic Versioning 2.0.0](https://semver.org/) for detailed guidelines.

## [0.4.0] - 2026-01-29

### macOS Visualiser

#### Added

- **M3.5 Track A: Split Streaming Support**
  - Background caching with sequence validation for 96% bandwidth reduction
  - `CompositePointCloudRenderer` for dual-buffer rendering (background + foreground)
  - Cache state tracking (Empty/Cached/Refreshing) with UI indicator
  - `FrameType` enum: full/foreground/background/delta
  - `BackgroundSnapshot` struct with sequence number validation
  - `GridMetadata` struct for background grid parameters
  - Green dot "BG" status indicator showing cache state
  - Comprehensive test coverage (90%+) for new models and renderer

- **M4 Track A: Cluster Box Rendering**
  - Cluster bounding boxes rendered as cyan wireframe boxes
  - AABB dimensions from cluster features
  - OBB heading support when computed by clusterer
  - Semi-transparent rendering (alpha=0.7) to distinguish from tracks
  - 'C' toggle key and toolbar button for cluster visibility
  - Rendering order: background → foreground → clusters → tracks → trails

#### Documentation

- Added `docs/lidar/m3.5-macos-visualiser.md` - M3.5 architecture and implementation
- Added `docs/lidar/m4-macos-visualiser.md` - M4 cluster rendering details
- Updated `tools/visualiser-macos/README.md` with M3.5/M4 features

### Radar Server

#### Added

- Comparison report generation (T1/T2 period analysis)
  - Before/after speed distribution comparison
  - Percentage change calculations and tolerance thresholds
  - Dual-period chart overlays
- Site configuration with Slowly Changing Dimension (Type 6 SCD) pattern
  - Cosine correction periods for radar mounting angle compensation
  - Historical site configuration tracking with effective timestamps
  - Full precision angle calculations using math.Pi/180
- Transit worker inspector with full-history rebuild capability
  - Manual trigger for full transit reprocessing
  - Deduplication detection and cleanup tools
  - Enhanced status tracking and run management
- Database stats API endpoint with path validation
- Hourly transit worker job with UI toggle for enabling/disabling
- Security validation for PDF path to prevent path traversal attacks
- Boundary hour filtering to RadarObjectRollupRange for improved data accuracy
- Min speed filtering support in report generation

#### Changed

- Model version default changed from "rebuild-full" to "hourly-cron" for radar transits
- Enhanced histogram aggregation with max bucket support

#### Fixed

- Build failure with stub generation

### LiDAR Server

#### Added

- Foreground tracking API with real-time object detection and classification
  - Foreground mask extraction, coordinate transformation, and DBSCAN clustering
  - Track management with confirmation thresholds and plausibility checks
  - REST API endpoints for track and cluster queries
  - ML training data storage for future classification improvements
- Track visualisation UI with interactive map, timeline, and track list
  - Real-time and historical playback modes
  - Track history paths and observation toggle
  - Background grid overlay for debugging
- Adaptive region segmentation for background grid
  - Automatic threshold adjustment based on environment characteristics
  - Region identification with warmup frame handling
  - Debug dashboard for region parameter visualisation
- PCAP analysis tool for batch track categorisation and ML data export
- Foreground forwarding and debugging capabilities

#### Changed

- Track confirmation now requires 5 hits with position jump and speed plausibility checks
- Background grid thresholds tuned to achieve <30 false positives

#### Fixed

- WarmupFramesRemaining initialisation and reset logic in background grid
- JSON serialisation for region parameters
- Reflected cross-site scripting vulnerability in dashboard (security fix)
- XSS prevention with escaped query strings in debug dashboards

### PDF Generator

#### Added

- Comparison report generation with dual-period analysis
  - Side-by-side T1/T2 period statistics
  - Percentage change calculations with configurable thresholds
  - Combined vehicle total calculations
- Enhanced chart builder with integer indices and simplified bar width computation
- Table builders for detailed data output with improved formatting
- Boundary hour filtering and summary metric derivation functions
- Day boundary calculations with percentile line plotting in time-series charts
- Max bucket parameter for histogram generation with improved label formatting
- Velocity unit support (mph, km/h, m/s) in reports

#### Changed

- Report sections enhanced with combined vehicle totals and improved table formatting
- Histogram label formatting centralised for consistency
- Chart builder refactored for comparison overlays

### Deploy Tool

#### Added

- Transit command for analysis, deletion, migration, and rebuilding
- Full-history run capability for transit worker

### Web Frontend

#### Added

- LiDAR tracks page with map pane, timeline, and track list components
  - Real-time track visualisation with history paths
  - Pagination support for track lists
  - Observation filters and toggle options
- Reports page with comparison period selection
  - Date range pickers for T1 and T2 periods
  - Boundary threshold and min speed configuration
  - Max speed cutoff filtering
  - Settings persistence to local storage
- Transit worker management UI in settings
  - Enable/disable toggle with manual run trigger
  - Full history rebuild option
  - Run status and history display
- Site configuration management with cosine correction periods
- Data source selector component for report generation
- Dark mode styles for LiDAR dashboards

#### Changed

- Layout enhanced with LiDAR tracks navigation
- Report generation form refactored for improved responsiveness

### Documentation

#### Added

- Comprehensive setup guide for Citizen Radar deployment
  - Bill of materials with cost estimates
  - Step-by-step installation instructions
  - Sensor mounting guidance with cosine correction explanation
- CLI architecture long-term vision and implementation plan
- LiDAR alignment planning and dual return format documentation
- Adaptive region parameters documentation
- Transit deduplication plan
- Security review of data partitioning plan with CVE mitigations
- Time-based speed limit schedules feature specification
- PCAP split design specification
- LiDAR background grid standards and export options
- ML pipeline roadmap with analysis runs and labeling UI architecture

#### Changed

- Documentation site migrated to pnpm with Tailwind CSS v4
- Enhanced dark mode support throughout documentation
- Improved card-based layouts for guides and community pages

### Build System

#### Added

- `make set-version` utility to update version across entire codebase
- `make schema-sync` target to regenerate schema.sql from migrations
- `make format-sql` target for SQL formatting
- SQL formatter configuration and formatting script

## [0.3.0] - 2025-12-01

### Radar Server

#### Added

- Transit worker for automatic sessionization of radar data into transits
  - Configurable via `--enable-transit-worker` flag (enabled by default)
  - Hourly cron-style processing with configurable interval and window
  - Manual trigger support via API endpoint
- Transit worker status tracking and health monitoring
  - New `/api/transit_worker` endpoint with GET/POST support
  - Status includes: enabled state, last run time, error info, run count, health status
- Version and git SHA logging on server startup for better debugging
- Database migration system with historical schema support
  - Migration 000001: Original schema (timestamp column, pre-JSON)
  - Migration 000002: JSON storage and write_timestamp migration
  - Migrations now properly handle legacy databases

#### Changed

- Database variable naming: `db` → `database` to avoid package shadowing
- Transit worker API responses now return full status instead of just enabled flag

#### Fixed

- Package shadowing issue where variable `db` conflicted with package name `db`
- Transit worker compatibility with old database schemas via proper migrations

### Deploy Tool

#### Added

- `--no-migrate` flag for upgrade command to skip database migrations
- Automatic database migrations during upgrade (enabled by default)
- Migrations run while service is stopped for safety

#### Changed

- Source code and Python dependency updates are now optional (skip gracefully if source not present)
- Improved error handling for binary-only installations

#### Fixed

- Upgrade warnings for missing source directory (now handled gracefully)
- Migration execution properly runs as service user with correct permissions

### Documentation

#### Added

- Database migration documentation explaining historical schema evolution
- SQL migration files cleaned up with better readability and comments

## [0.2.0] - 2025-12-01

### All Components

**Version Baseline:** This release establishes version 0.2.0 as the baseline for all components (Radar, PDF Generator, Deploy Tool, Web Frontend).

## [0.1.0] - 2025-11-30

### Radar Application

#### Added

- Version information embedded at build time via ldflags
- Git SHA tracking in binary
- Command-line version flags (`--version`, `-v`)
- `version` subcommand support
- Database migration system with schema version tracking
- Support for `--db-path` flag to specify database location
- LiDAR integration support (optional, via `--enable-lidar`)
- HTTP API endpoints for radar data and statistics
- Embedded web frontend (SvelteKit)
- Serial port multiplexing for radar sensor
- Speed unit conversion (mps, mph, kmph)
- Timezone support for timestamps

#### Changed

- Database schema version: 8
- Default database location: `sensor_data.db` (relative to working directory)

#### Fixed

- Database initialization on first run
- Serial port handling and error recovery

### PDF Generator

#### Added

- PDF report generation from radar data
- Chart generation (speed distribution, time series, etc.)
- Configurable report templates
- LaTeX-based document generation
- CLI interface with `pdf-generator` command
- Example configuration files
- Support for site information and metadata

#### Fixed

- Chart rendering with matplotlib
- Date parsing and timezone handling

### Deploy Tool

#### Added

- Installation command for local and remote hosts
- Upgrade command with automatic backup
- Rollback capability
- Status and health check commands
- SSH config support for remote deployments
- Systemd service management
- Configuration viewer and editor
- Backup and restore functionality
- Fix command for repairing broken installations

#### Configuration

- Default service user: `velocity` (dedicated system user)
- Data directory: `/var/lib/velocity-report`
- Binary location: `/usr/local/bin/velocity-report`

### Web Frontend

#### Added

- SvelteKit-based web interface
- Real-time radar data visualization
- Statistics dashboard
- API integration with Go backend
- Responsive design

---

## Links

- [GitHub Repository](https://github.com/banshee-data/velocity.report)
- [Documentation](./docs/)
- [Issue Tracker](https://github.com/banshee-data/velocity.report/issues)
- [Releases](https://github.com/banshee-data/velocity.report/releases)
